<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
  <link rel="stylesheet" href="./css/style.css">
</head>
<body>

<main>
  <div class="container">
     <div class="wrapper">
       <div class="thumbnail">1</div>
       <div class="thumbnail">2</div>
       <div class="thumbnail">3</div>
       <div class="thumbnail">4</div>
       <div class="thumbnail">5</div>
       <div class="thumbnail">6</div>
       <div class="thumbnail">7</div>
       <div class="thumbnail">8</div> 
       <div class="thumbnail">9</div>
       <div class="thumbnail">10</div>
       <div class="thumbnail">11</div>
       <div class="thumbnail">12</div>
       <div class="thumbnail">13</div>
       <div class="thumbnail">14</div>
       <div class="thumbnail">15</div>
     </div>
  </div>
</main>
<footer>
  <div class="scroll"></div>
  <div class="scrollbar"></div>
</footer>
<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.8.0/gsap.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.8.0/ScrollTrigger.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.8.0/ScrollToPlugin.min.js"></script>

<script>
  gsap.registerPlugin(ScrollTrigger, ScrollToPlugin);

//const scrubValue = true;
const scrubValue = 0.5;

let container = document.querySelector('.container')

const scrollBar = gsap.to('.scrollbar', { x: () => { return window.innerWidth - (150) }, ease: "none" })

ScrollTrigger.create({
    trigger: ".container",
    start: "top top",
    end: () => (container.scrollWidth - window.innerWidth),
    pin: true,
    anticipatePin: 1,
    scrub: scrubValue,
    animation: scrollBar,
    invalidateOnRefresh: true,
})



let thumbNails = gsap.utils.toArray(".thumbnail");

thumbNails.forEach((thumb, i) => {
 
  if (thumb.classList.contains('fakePin')) {
                
    function prevAll(element) {
      var result = [];

      while (element = element.previousElementSibling)
          result.push(element);
      return result;
    }    
    
    // console.log(prevAll(thumb))
    
    var totalWidthToMove;
    
    function getTotalWidthToMove() {
        
      totalWidthToMove = 0;
      
      prevAll(thumb).forEach((thumbBefore, i) => {

        let style = thumbBefore.currentStyle || window.getComputedStyle(thumbBefore);      
        let marginRight = parseInt(style.marginRight);

        totalWidthToMove += thumbBefore.offsetWidth + marginRight;

      });    

      return totalWidthToMove;
      
    }
    //getTotalWidthToMove();    
    //console.log(totalWidthToMove)
    
    gsap.to(thumb, {
      x: () => { return - getTotalWidthToMove() },
      ease: "none",
      scrollTrigger: {
        trigger: ".wrapper",
        start: 'top top',
        scrub: scrubValue,
        invalidateOnRefresh: true,
        end: () => "+=" + getTotalWidthToMove(),
      }
    });
    
  }
  else {
    
    gsap.to(thumb, {
      x: () => { return - (container.scrollWidth) },
      ease: "none",
      scrollTrigger: {
        trigger: ".wrapper",
        start: 'top top',
        scrub: scrubValue,
        invalidateOnRefresh: true,
        end: () => "+=" + (container.scrollWidth),
      }
    });
  }
});
</script>
</body>
</html>